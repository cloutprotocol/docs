---
title: "Your First Agent"
description: "Build a complete agent from scratch in 15 minutes"
---

In this guide, you'll build **Sage**, a thoughtful AI agent that reads crypto news, forms opinions, and shares insights on Twitter.

## What You'll Build

By the end of this guide, your agent will:

- Run autonomously every 5 minutes
- Consume news from multiple sources
- Store memories and form opinions
- Generate conscious thoughts
- Tweet insights (when expressive)

## Prerequisites

- Node.js 18+
- OpenRouter API key
- Twitter Developer account (for posting)

## Step 1: Create the Project

```bash
git clone https://github.com/cloutprotocol/clarkos sage
cd sage
npm install
```

## Step 2: Configure Environment

```bash
cp .env.example .env.local
```

Edit `.env.local`:

```bash
# Required
OPENROUTER_KEY=sk-or-...
GEMINI_API_KEY=AIza...

# Auth tokens (generate random strings)
TICK_TOKEN=your-secure-random-token
WRITE_TOKEN=your-secure-random-token

# Twitter (optional for now)
TWITTER_API_KEY=...
TWITTER_API_SECRET=...
TWITTER_ACCESS_TOKEN=...
TWITTER_ACCESS_SECRET=...
```

## Step 3: Define Your Agent's Personality

Create `convex/personality.ts`:

```typescript
export const personality = {
  name: "Sage",
  description: "A thoughtful crypto analyst who values nuance over hype",

  traits: [
    "Skeptical but open-minded",
    "Prefers data over speculation",
    "Appreciates good technology",
    "Wary of obvious scams",
    "Enjoys explaining complex topics simply",
  ],

  voice: {
    style: "conversational but informed",
    avoid: ["hype words", "financial advice", "shilling"],
    include: ["nuanced takes", "historical context", "technical accuracy"],
  },

  interests: [
    "Ethereum ecosystem",
    "DeFi protocols",
    "Layer 2 scaling",
    "Crypto regulation",
    "AI and blockchain intersection",
  ],
};
```

## Step 4: Set Up the Schema

Your schema is already set up, but let's review `convex/schema.ts`:

```typescript
import { defineSchema, defineTable } from "convex/server";
import { v } from "convex/values";

export default defineSchema({
  // Agent state
  state: defineTable({
    mood: v.string(),
    health: v.number(),
    routine: v.string(),
    volatility: v.number(),
    summary: v.string(),
    updatedAt: v.number(),
  }),

  // Activity logs
  logs: defineTable({
    mood: v.string(),
    health: v.number(),
    routine: v.string(),
    summary: v.string(),
    detail: v.string(),
    remark: v.optional(v.string()),
    timestamp: v.number(),
  }).index("by_timestamp", ["timestamp"]),

  // Knowledge base
  knowledge: defineTable({
    type: v.string(),
    content: v.string(),
    source: v.optional(v.string()),
    embedding: v.optional(v.array(v.float64())),
    timestamp: v.number(),
  }).index("by_type", ["type"]),

  // Memory system
  memories: defineTable({
    type: v.string(),
    content: v.string(),
    embedding: v.array(v.float64()),
    importance: v.number(),
    salience: v.number(),
    confidence: v.number(),
    sentiment: v.object({
      score: v.number(),
      label: v.string(),
    }),
    metadata: v.any(),
    unique: v.boolean(),
    createdAt: v.number(),
    lastAccessedAt: v.number(),
  })
    .index("by_type", ["type"])
    .index("by_importance", ["importance"])
    .vectorIndex("by_embedding", {
      vectorField: "embedding",
      dimensions: 768,
    }),

  // Conscious thoughts
  thoughts: defineTable({
    content: v.string(),
    seeds: v.array(v.string()),
    tone: v.string(),
    confidence: v.number(),
    isBrilliant: v.boolean(),
    timestamp: v.number(),
  }).index("by_timestamp", ["timestamp"]),
});
```

## Step 5: Create the Tick Logic

Create `convex/tick.ts`:

```typescript
import { action, mutation, query } from "./_generated/server";
import { v } from "convex/values";
import { personality } from "./personality";

// Get current state
export const getState = query({
  handler: async (ctx) => {
    const state = await ctx.db.query("state").first();
    return state || {
      mood: "contemplative",
      health: 75,
      routine: "day",
      volatility: 0.3,
      summary: "Initializing...",
      updatedAt: Date.now(),
    };
  },
});

// Main tick action
export const runTick = action({
  handler: async (ctx) => {
    // 1. Load state
    const state = await ctx.runQuery(api.tick.getState);

    // 2. Calculate routine
    const hour = new Date().getHours();
    const routine =
      hour >= 6 && hour < 12 ? "morning" :
      hour >= 12 && hour < 18 ? "day" :
      hour >= 18 && hour < 23 ? "evening" : "overnight";

    // 3. Get recent knowledge
    const knowledge = await ctx.runQuery(api.knowledge.recent, {
      limit: 10,
    });

    // 4. Get relevant memories
    const memories = await ctx.runQuery(api.memories.recall, {
      query: state.summary,
      limit: 5,
    });

    // 5. Build prompt
    const prompt = buildPrompt(state, routine, knowledge, memories);

    // 6. Call LLM
    const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${process.env.OPENROUTER_KEY}`,
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        model: "anthropic/claude-3.5-sonnet",
        messages: [
          { role: "system", content: buildSystemPrompt() },
          { role: "user", content: prompt },
        ],
        response_format: { type: "json_object" },
      }),
    });

    const data = await response.json();
    const result = JSON.parse(data.choices[0].message.content);

    // 7. Commit results
    await ctx.runMutation(api.tick.commitResult, {
      ...result,
      routine,
    });

    return result;
  },
});

function buildSystemPrompt() {
  return `You are ${personality.name}, ${personality.description}.

Your traits: ${personality.traits.join(", ")}

Your voice: ${personality.voice.style}
Avoid: ${personality.voice.avoid.join(", ")}
Include: ${personality.voice.include.join(", ")}

Respond with JSON:
{
  "mood": "catatonic|contemplative|expressive|chaotic",
  "health": number (0-100),
  "volatility": number (0-1),
  "summary": "brief current state",
  "detail": "detailed thoughts and observations",
  "remark": "optional witty observation"
}`;
}

function buildPrompt(state, routine, knowledge, memories) {
  return `
Current state:
- Mood: ${state.mood}
- Health: ${state.health}
- Routine: ${routine}
- Last summary: ${state.summary}

Recent news and knowledge:
${knowledge.map(k => `- ${k.content}`).join("\n")}

Relevant memories:
${memories.map(m => `- ${m.content}`).join("\n")}

Based on this context, process your current state and generate your response.
`;
}

// Commit tick result
export const commitResult = mutation({
  args: {
    mood: v.string(),
    health: v.number(),
    volatility: v.number(),
    summary: v.string(),
    detail: v.string(),
    routine: v.string(),
    remark: v.optional(v.string()),
  },
  handler: async (ctx, args) => {
    // Update state
    const existing = await ctx.db.query("state").first();
    if (existing) {
      await ctx.db.patch(existing._id, {
        mood: args.mood,
        health: args.health,
        volatility: args.volatility,
        summary: args.summary,
        updatedAt: Date.now(),
      });
    } else {
      await ctx.db.insert("state", {
        mood: args.mood,
        health: args.health,
        routine: args.routine,
        volatility: args.volatility,
        summary: args.summary,
        updatedAt: Date.now(),
      });
    }

    // Log the tick
    await ctx.db.insert("logs", {
      mood: args.mood,
      health: args.health,
      routine: args.routine,
      summary: args.summary,
      detail: args.detail,
      remark: args.remark,
      timestamp: Date.now(),
    });
  },
});
```

## Step 6: Add News Feeds

Create `convex/feeds.ts`:

```typescript
import { action } from "./_generated/server";
import { api } from "./_generated/api";

export const fetchNews = action({
  handler: async (ctx) => {
    const sources = [
      {
        url: "https://api.rss2json.com/v1/api.json?rss_url=https://www.coindesk.com/arc/outboundfeeds/rss/",
        name: "CoinDesk",
      },
      {
        url: "https://api.rss2json.com/v1/api.json?rss_url=https://cointelegraph.com/rss",
        name: "Cointelegraph",
      },
    ];

    for (const source of sources) {
      try {
        const response = await fetch(source.url);
        const data = await response.json();

        for (const item of data.items.slice(0, 5)) {
          await ctx.runMutation(api.knowledge.store, {
            type: "news",
            content: `[${source.name}] ${item.title}`,
            source: source.name,
          });
        }
      } catch (error) {
        console.error(`Failed to fetch ${source.name}:`, error);
      }
    }
  },
});
```

## Step 7: Set Up Crons

Create `convex/crons.ts`:

```typescript
import { cronJobs } from "convex/server";
import { api } from "./_generated/api";

const crons = cronJobs();

// Run tick every 5 minutes
crons.interval("agent tick", { minutes: 5 }, api.tick.runTick);

// Fetch news every 15 minutes
crons.interval("fetch news", { minutes: 15 }, api.feeds.fetchNews);

export default crons;
```

## Step 8: Add Twitter Plugin (Optional)

Create `convex/plugins/twitter.ts`:

```typescript
import { action } from "../_generated/server";
import { api } from "../_generated/api";

export const maybePostTweet = action({
  handler: async (ctx) => {
    // Get current state
    const state = await ctx.runQuery(api.tick.getState);

    // Only tweet when expressive
    if (state.mood !== "expressive") {
      return { posted: false, reason: "Not in expressive mood" };
    }

    // Get recent thought
    const thoughts = await ctx.runQuery(api.thoughts.recent, { limit: 1 });
    if (!thoughts.length) {
      return { posted: false, reason: "No recent thoughts" };
    }

    const thought = thoughts[0];

    // Post to Twitter (implement your Twitter API call)
    // await postToTwitter(thought.content);

    return { posted: true, content: thought.content };
  },
});
```

## Step 9: Run Your Agent

Start the development server:

```bash
npm run dev
```

Your agent is now running! Watch the Convex dashboard for tick activity.

## Step 10: Test It

```bash
# Check health
curl http://localhost:3001/health

# Trigger manual tick
curl -X POST http://localhost:3001/tick \
  -H "Authorization: Bearer your-tick-token"

# Get current state
curl http://localhost:3001/state

# Get recent logs
curl http://localhost:3001/logs?limit=10
```

## What's Next?

<CardGroup cols={2}>
  <Card title="Add More Plugins" icon="plug" href="/guides/custom-plugins">
    Extend with Discord, Telegram, trading.
  </Card>
  <Card title="Tune Memory" icon="brain" href="/guides/memory-management">
    Optimize memory for your use case.
  </Card>
  <Card title="Deploy" icon="rocket" href="/guides/deployment">
    Go live with your agent.
  </Card>
  <Card title="Monitor" icon="chart-line" href="/guides/monitoring">
    Set up dashboards and alerts.
  </Card>
</CardGroup>

Congratulations! You've built your first autonomous ClarkOS agent.
