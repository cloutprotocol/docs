---
title: "Memory System"
description: "Multi-layered cognitive memory inspired by human psychology"
---

## Overview

ClarkOS implements a cognitive psychology-inspired memory architecture that goes beyond simple storage. The system features multiple memory types, vector embeddings for semantic search, automatic deduplication, memory consolidation, bidirectional linking, and self-reflection capabilities.

## Memory Types

ClarkOS supports five distinct memory types:

| Type | Purpose | Example |
|------|---------|---------|
| **Episodic** | Specific events and experiences | "Met Alice at the hackathon" |
| **Semantic** | Facts and concepts | "Ethereum uses proof-of-stake" |
| **Emotional** | Feelings about topics | "Excited about AI agents" |
| **Procedural** | Learned patterns and behaviors | "When market drops, users want reassurance" |
| **Reflection** | Self-reflective insights | "I notice I'm more creative in the evening" |

The reflection type is unique to ClarkOS and enables metacognitive capabilities.

## Memory Structure

Every memory contains rich metadata:

```typescript
interface Memory {
  id?: string;
  ts: string;
  content: string;
  type: MemoryType;
  scope: "short_term" | "working" | "long_term";

  // Vector embedding for semantic search
  embedding?: number[];
  embeddingModel?: string;

  // Emotional metadata
  sentiment: number;           // -1 to 1
  valence: "positive" | "negative" | "neutral" | "mixed";
  emotionalIntensity: number;  // 0 to 1

  // Importance and access tracking
  importance: number;          // 0 to 1, decays over time
  accessCount: number;         // Strengthens with use
  lastAccessedAt: number;

  // Associations
  tags: string[];
  linkedMemoryIds: string[];
  sourceType: string;          // "news", "market", "user", "self"
  sourceId?: string;

  // Consolidation tracking
  isConsolidated: boolean;
  consolidatedIntoId?: string;

  // Enhanced fields
  unique?: boolean;            // Passed deduplication check
  salience?: number;           // How attention-grabbing (0-1)
  confidence?: number;         // How reliable (0-1)
  version?: number;            // Update tracking

  // Rich context
  metadata?: {
    context?: string;
    mood?: string;
    routine?: string;
    triggerMemoryId?: string;
    relatedEntities?: string[];
  };
}
```

## Deduplication

ClarkOS uses type-specific similarity thresholds for deduplication:

| Type | Threshold | Rationale |
|------|-----------|-----------|
| Episodic | 0.92 | Events can be similar but distinct |
| Semantic | 0.88 | Facts should consolidate easily |
| Emotional | 0.85 | Feelings about same topic merge |
| Procedural | 0.90 | Patterns need precision |
| Reflection | 0.95 | Self-insights should be unique |

```typescript
// Store with deduplication
const result = await memories.storeWithDedup({
  type: "episodic",
  content: "Met Alice at the hackathon",
  importance: 0.7
});

if (result.deduplicated) {
  console.log("Similar memory exists:", result.existingId);
}
```

## Memory Linking

Memories can be linked with bidirectional relationships:

| Link Type | Description |
|-----------|-------------|
| `caused_by` | Causal relationship |
| `related_to` | Semantic similarity |
| `contradicts` | Conflicting information |
| `elaborates` | Provides more detail |
| `supersedes` | Replaces/updates |
| `temporal_before` | Happened before |
| `temporal_after` | Happened after |

```typescript
// Automatic link detection
const links = detectPotentialLinks(newMemory, existingMemories, {
  minSimilarity: 0.7,
  maxLinks: 5,
  detectContradictions: true
});

// Get memory with all its links
const linked = getLinkedMemories(memoryId, memories, links, {
  direction: "both"
});
```

## Memory Consolidation

Over time, related memories consolidate into core memories:

```typescript
interface CoreMemory {
  theme: string;              // Central topic
  summary: string;            // Consolidated knowledge
  insights: string[];         // Key takeaways
  sourceMemoryIds: string[];  // Contributing memories
  importance: number;
  timespan: {
    earliest: number;
    latest: number;
  };
}
```

The consolidation process:
1. **Clustering** - Group similar memories by embedding
2. **Theme Extraction** - Identify common topics
3. **Summary Generation** - Create consolidated knowledge
4. **Importance Decay** - Reduce weight of old memories
5. **Core Formation** - Create or update core memories

## Self-Reflection

ClarkOS can generate metacognitive insights from memory patterns:

```typescript
const reflection = generateSelfReflection(memories, coreMemories, associations);

// Returns:
// {
//   reflections: [...],  // Individual reflections
//   overallInsight: "...",
//   memoryDraft: { type: "reflection", content: "...", ... }
// }
```

Reflection types:
- **Emotional** - Patterns in feelings
- **Knowledge** - What's been learned
- **Behavioral** - Activity patterns
- **Growth** - How things are changing

## REST API

```bash
# List memories
GET /memories?type=episodic&limit=10

# Get core memories
GET /memories/core

# Store a memory
POST /memories/store
{
  "type": "semantic",
  "content": "Layer 2 solutions reduce gas fees",
  "importance": 0.8
}

# Store with deduplication
POST /memories/store-dedup

# Run consolidation
POST /memories/consolidate

# Generate self-reflection
POST /memories/reflect

# Get memory with links
GET /memories/linked?id=...
```

## SDK Status

Current SDK implementation:
- 3 memory types (episodic, semantic, procedural)
- Basic memory storage and retrieval
- Memory store interface

Expanding to include:
- Emotional and reflection memory types
- Vector embeddings and semantic search
- Bidirectional linking
- Consolidation engine
- Self-reflection generation
- Type-specific deduplication

## Next Steps

<CardGroup cols={2}>
  <Card title="Consciousness" icon="lightbulb" href="/concepts/consciousness">
    How memories become thoughts.
  </Card>
  <Card title="Tick System" icon="clock" href="/concepts/tick-system">
    How memories integrate with execution.
  </Card>
</CardGroup>
